CONFIG set enforce_statfs=1;
CONFIG set allow.mount.procfs;
CONFIG set mount.procfs;

RESTART

ARG VERSION=7
ARG JAVA_VERSION=11
ARG CLUSTER_NAME=elasticsearch
ARG NODE_NAME=node-1
ARG NETWORK_HOST=

# install required packages
PKG elasticsearch${VERSION} openjdk${JAVA_VERSION}

# copy files
# CP usr /

# enable and start elasticsearch
SYSRC elasticsearch_enable=YES
SYSRC elasticsearch_java_home=/usr/local/openjdk${JAVA_VERSION}

#CMD if [ ! -z ${CLUSTER_NAME} ];then echo "cluster.name: ${CLUSTER_NAME}" >> /usr/local/etc/elasticsearch/elasticsearch.yml; fi
#CMD if [ ! -z ${NODE_NAME} ];then echo "node.name: ${NODE_NAME}" >> /usr/local/etc/elasticsearch/elasticsearch.yml; fi
#CMD if [ ! -z ${NETWORK_HOST} ];then echo "network.host: ${NETWORK_HOST}" >> /usr/local/etc/elasticsearch/elasticsearch.yml; echo "discovery.seed_hosts: [\"${NETWORK_HOST}\"]" >> /usr/local/etc/elasticsearch/elasticsearch.yml; fi
#CMD if [ ! -z ${NODE_NAME} ];then echo "cluster.initial_master_nodes: [\"${NODE_NAME}\"]" >> /usr/local/etc/elasticsearch/elasticsearch.yml; fi

#CMD if [ "${VERSION}" -gt 7 ]; then echo "# FIXME: Re-enable security measures for production!" >> /usr/local/etc/elasticsearch/elasticsearch.yml; fi
#CMD if [ "${VERSION}" -gt 7 ]; then echo "xpack.security:" >> /usr/local/etc/elasticsearch/elasticsearch.yml; fi
#CMD if [ "${VERSION}" -gt 7 ]; then echo "  enabled: false" >> /usr/local/etc/elasticsearch/elasticsearch.yml; fi
#CMD if [ "${VERSION}" -gt 7 ]; then echo "  enrollment.enabled: false" >> /usr/local/etc/elasticsearch/elasticsearch.yml; fi
#CMD if [ "${VERSION}" -gt 7 ]; then echo "  http.ssl.enabled: false" >> /usr/local/etc/elasticsearch/elasticsearch.yml; fi
#CMD if [ "${VERSION}" -gt 7 ]; then echo "  transport.ssl.enabled: false" >> /usr/local/etc/elasticsearch/elasticsearch.yml; fi

SERVICE elasticsearch start
